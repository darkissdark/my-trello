"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[193],{193:(t,a,e)=>{e.r(a),e.d(a,{CardDetails:()=>m});var i=e(379),r=e(43),s=e(2),d=e(3),c=e(603),o=e(979),n=e.n(o),l=e(373),u=e(886),p=e(579);function m(t){var a;let{card:e,boardId:o,onCardUpdated:m,currentUser:h}=t;const v=(0,s.Zp)(),b=(0,d.wA)(),[y,j]=(0,r.useState)(e.title),[x,f]=(0,r.useState)(e.description||""),[g,w]=(0,r.useState)([]),[C,N]=(0,r.useState)(!1),[E,k]=(0,r.useState)(!1),[_,A]=(0,r.useState)(!1),[S,U]=(0,r.useState)([]),L=(0,r.useRef)(null),R=null===h||void 0===h?void 0:h.id;(0,r.useEffect)((()=>{const t=t=>{"Escape"===t.key&&(C&&(j(e.title),N(!1)),E&&(f(e.description||""),k(!1)),_&&A(!1),C||E||_||(b((0,l.Oo)()),v("/board/".concat(o))))},a=t=>{L.current&&!L.current.contains(t.target)&&(b((0,l.Oo)()),v("/board/".concat(o)))};return document.addEventListener("keydown",t),document.addEventListener("mousedown",a),()=>{document.removeEventListener("keydown",t),document.removeEventListener("mousedown",a)}}),[o,e.title,e.description,b,v,C,E,_]),(0,r.useEffect)((()=>{(async()=>{try{const t=await c.A.get("/board/".concat(o));U(t.data.lists||[])}catch(t){console.error("Error fetching lists:",t)}})(),(async()=>{if(e.users&&e.users.length>0&&h){const t=e.users.map((t=>({id:t,email:h.email||"no email",username:h.username||"no username"})));w(t)}})()}),[o,e.users,h]);const O=async()=>{if(y.trim()===e.title||!y.trim())return j(e.title),void N(!1);try{"Updated"===(await c.A.put("/board/".concat(o,"/card/").concat(e.id),{title:y.trim(),description:e.description||"",list_id:e.list_id})).data.result&&(m(),N(!1))}catch(t){console.error("Error updating card title:",t),j(e.title)}};return(0,p.jsx)("div",{className:"card-details-overlay",children:(0,p.jsxs)("div",{className:"card-details-modal",ref:L,children:[(0,p.jsx)("button",{className:"card-details-close",onClick:()=>{b((0,l.Oo)()),v("/board/".concat(o))},children:"\xd7"}),(0,p.jsxs)("div",{className:"card-details-content",children:[(0,p.jsx)("div",{className:"card-details-title",children:(0,p.jsx)(u.Y,{as:"textarea",value:y,onChange:j,onBlur:O,onSubmit:O,placeholder:"\u041d\u0430\u0437\u0432\u0430 \u043a\u0430\u0440\u0442\u043a\u0438",autoFocus:!1})}),(0,p.jsxs)("div",{children:["\u0412 \u043a\u043e\u043b\u043e\u043d\u0446\u0456:"," ",0===S.length?"\u0417\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f...":(null===(a=S.find((t=>t.id===e.list_id)))||void 0===a?void 0:a.title)||"\u041d\u0435\u0432\u0456\u0434\u043e\u043c\u043e"]}),(0,p.jsxs)("div",{className:"card-details-participants",children:[(0,p.jsx)("h3",{children:"\u0423\u0447\u0430\u0441\u043d\u0438\u043a\u0438"}),(0,p.jsxs)("div",{className:"card-details-participant-list",children:[g.map((t=>(0,p.jsx)("div",{className:"card-details-participant-avatar",children:t.username.charAt(0).toUpperCase()},t.id))),(0,p.jsx)("button",{className:"card-details-join-button",onClick:g.some((t=>t.id===R))?async()=>{if(h&&g.some((t=>t.id===h.id)))try{"Updated"===(await c.A.put("/board/".concat(o,"/card/").concat(e.id,"/users"),{add:[],remove:[h.id]})).data.result&&(w(g.filter((t=>t.id!==h.id))),m())}catch(t){console.error("Error leaving card:",t)}}:async()=>{if(h&&!g.some((t=>t.id===h.id)))try{"Updated"===(await c.A.put("/board/".concat(o,"/card/").concat(e.id,"/users"),{add:[h.id],remove:[]})).data.result&&(w([...g,h]),m())}catch(t){console.error("Error joining card:",t)}},children:g.some((t=>t.id===R))?"\u041f\u043e\u043a\u0438\u043d\u0443\u0442\u0438":"\u041f\u0440\u0438\u0454\u0434\u043d\u0430\u0442\u0438\u0441\u044f"})]})]}),(0,p.jsxs)("div",{className:"card-details-description",children:[(0,p.jsx)("h3",{children:"\u041e\u043f\u0438\u0441"}),(0,p.jsx)(u.Y,{value:x,onChange:f,onBlur:async()=>{if(x.trim()!==e.description)try{"Updated"===(await c.A.put("/board/".concat(o,"/card/").concat(e.id),{title:e.title,description:x.trim(),list_id:e.list_id})).data.result&&(m(),k(!1))}catch(t){console.error("Error updating card description:",t),f(e.description||"")}else k(!1)},placeholder:"\u0414\u043e\u0434\u0430\u0439\u0442\u0435 \u043e\u043f\u0438\u0441...",as:"textarea",disableValidation:!0})]})]}),(0,p.jsxs)("div",{className:"card-details-actions",children:[(0,p.jsx)("h3",{children:"\u0414\u0456\u0457"}),(0,p.jsx)("button",{onClick:async()=>{console.log("Copying card:",e);try{"Created"===(await c.A.post("/board/".concat(o,"/card"),{title:"".concat(e.title," - Copy"),list_id:e.list_id,position:e.position+1,description:e.description,custom:e.custom})).data.result&&(m(),v("/board/".concat(o)),n().success({title:"\u041a\u0430\u0440\u0442\u043a\u0443 \u0441\u043a\u043e\u043f\u0456\u0439\u043e\u0432\u0430\u043d\u043e",position:"topRight"}))}catch(t){console.error("Error copying card:",t)}},className:"card-details-action-button",children:"\u041a\u043e\u043f\u0456\u044e\u0432\u0430\u0442\u0438"}),S.filter((t=>t.id!==e.list_id)).length>0&&(0,p.jsxs)("div",{className:"card-details-move-button-wrapper",children:[(0,p.jsx)("button",{onClick:()=>A(!_),className:"card-details-action-button",children:"\u041f\u0435\u0440\u0435\u043c\u0456\u0449\u0435\u043d\u043d\u044f"}),_&&(0,p.jsx)("div",{className:"card-details-move-dropdown",children:S.filter((t=>t.id!==e.list_id)).map((t=>(0,p.jsx)("button",{onClick:()=>(async t=>{try{var a;"Updated"===(await c.A.put("/board/".concat(o,"/card"),[{id:e.id,list_id:t,position:(null===(a=S.find((a=>a.id===t)))||void 0===a?void 0:a.cards.length)||0}])).data.result&&(m(),b((0,l.qf)((0,i.A)((0,i.A)({},e),{},{list_id:t}))),n().success({title:"\u041a\u0430\u0440\u0442\u043a\u0443 \u043f\u0435\u0440\u0435\u043c\u0456\u0449\u0435\u043d\u043e",position:"topRight"}))}catch(r){console.error("Error moving card:",r)}A(!1)})(t.id),children:t.title},t.id)))})]}),(0,p.jsx)("button",{onClick:async()=>{try{"Deleted"===(await c.A.delete("/board/".concat(o,"/card/").concat(e.id))).data.result&&(m(),v("/board/".concat(o)),n().success({title:"\u041a\u0430\u0440\u0442\u043a\u0443 \u0430\u0440\u0445\u0456\u0432\u043e\u0432\u0430\u043d\u043e",position:"topRight"}))}catch(t){console.error("Error archiving card:",t)}},className:"card-details-action-button card-details-action-button--archive",children:"\u0410\u0440\u0445\u0456\u0432\u0443\u0432\u0430\u0442\u0438"})]})]})})}}}]);
//# sourceMappingURL=193.740d36ed.chunk.js.map