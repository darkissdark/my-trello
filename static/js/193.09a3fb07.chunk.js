"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[193],{193:(t,a,e)=>{e.r(a),e.d(a,{CardDetails:()=>h});var i=e(379),s=e(43),c=e(2),r=e(3),d=e(603),o=e(979),n=e.n(o),l=e(373),u=e(886),p=e(579);function h(t){var a;let{card:e,boardId:o,onCardUpdated:h,currentUserId:m}=t;const v=(0,c.Zp)(),b=(0,r.wA)(),[j,x]=(0,s.useState)(e.title),[y,f]=(0,s.useState)(e.description||""),[g,w]=(0,s.useState)([]),[N,C]=(0,s.useState)(!1),[E,k]=(0,s.useState)(!1),[A,_]=(0,s.useState)(!1),[S,U]=(0,s.useState)([]),L=(0,s.useRef)(null);(0,s.useEffect)((()=>{const t=t=>{"Escape"===t.key&&(N&&(x(e.title),C(!1)),E&&(f(e.description||""),k(!1)),A&&_(!1),N||E||A||(b((0,l.Oo)()),v("/board/".concat(o))))},a=t=>{L.current&&!L.current.contains(t.target)&&(b((0,l.Oo)()),v("/board/".concat(o)))};return document.addEventListener("keydown",t),document.addEventListener("mousedown",a),()=>{document.removeEventListener("keydown",t),document.removeEventListener("mousedown",a)}}),[o,v,N,E,A,e.title,e.description,b]),(0,s.useEffect)((()=>{(async()=>{try{const t=await d.A.get("/board/".concat(o));U(t.data.lists||[])}catch(t){console.error("Error fetching lists:",t)}})(),(async()=>{if(e.users&&e.users.length>0)try{const t=await Promise.all(e.users.map((t=>d.A.get("/board/".concat(o,"/user/").concat(t)))));w(t.map((t=>t.data)))}catch(t){console.error("Error fetching card users:",t)}})()}),[o,e.users]);const R=async()=>{if(j.trim()!==e.title){if(""===j.trim())return x(e.title),void C(!1);try{"Updated"===(await d.A.put("/board/".concat(o,"/card/").concat(e.id),{title:j.trim(),description:e.description||"",list_id:e.list_id})).data.result&&(h(),C(!1))}catch(t){console.error("Error updating card title:",t),x(e.title)}}else C(!1)};return(0,p.jsx)("div",{className:"card-details-overlay",children:(0,p.jsxs)("div",{className:"card-details-modal",ref:L,children:[(0,p.jsx)("button",{className:"card-details-close",onClick:()=>{v("/board/".concat(o)),b((0,l.Oo)())},children:"\xd7"}),(0,p.jsxs)("div",{className:"card-details-content",children:[(0,p.jsx)("div",{className:"card-details-title",children:(0,p.jsx)(u.Y,{as:"textarea",value:j,onChange:x,onBlur:R,onSubmit:R,placeholder:"\u041d\u0430\u0437\u0432\u0430 \u043a\u0430\u0440\u0442\u043a\u0438",autoFocus:!1})}),(0,p.jsxs)("div",{className:"card-details-scroll-wrapper",children:[(0,p.jsxs)("div",{className:"break-word",children:["\u0412 \u043a\u043e\u043b\u043e\u043d\u0446\u0456: ",null===(a=S.find((t=>t.id===e.list_id)))||void 0===a?void 0:a.title]}),(0,p.jsxs)("div",{className:"card-details-participants",children:[(0,p.jsx)("h3",{children:"\u0423\u0447\u0430\u0441\u043d\u0438\u043a\u0438"}),(0,p.jsxs)("div",{className:"card-details-participant-list",children:[g.map((t=>(0,p.jsx)("div",{className:"card-details-participant-avatar",children:t.username.charAt(0).toUpperCase()},t.id))),(0,p.jsx)("button",{className:"card-details-join-button",onClick:async()=>{if(!g.some((t=>t.id===m)))try{if("Updated"===(await d.A.put("/board/".concat(o,"/card/").concat(e.id,"/users"),{add:[m]})).data.result){const t=await d.A.get("/board/".concat(o,"/user/").concat(m));w([...g,t.data]),h()}}catch(t){console.error("Error joining card:",t)}},children:"\u041f\u0440\u0438\u0454\u0434\u043d\u0430\u0442\u0438\u0441\u044f"})]})]}),(0,p.jsxs)("div",{className:"card-details-description",children:[(0,p.jsx)("h3",{children:"\u041e\u043f\u0438\u0441"}),(0,p.jsx)(u.Y,{value:y,onChange:f,onBlur:async()=>{if(y.trim()!==e.description)try{"Updated"===(await d.A.put("/board/".concat(o,"/card/").concat(e.id),{title:e.title,description:y.trim(),list_id:e.list_id})).data.result&&(h(),k(!1))}catch(t){console.error("Error updating card description:",t),f(e.description||"")}else k(!1)},placeholder:"\u0414\u043e\u0434\u0430\u0439\u0442\u0435 \u0434\u043e\u043a\u043b\u0430\u0434\u043d\u0456\u0448\u0438\u0439 \u043e\u043f\u0438\u0441...",as:"textarea",disableValidation:!0})]})]})]}),(0,p.jsxs)("div",{className:"card-details-actions",children:[(0,p.jsx)("h3",{children:"\u0414\u0456\u0457"}),(0,p.jsx)("button",{onClick:async()=>{try{"Created"===(await d.A.post("/board/".concat(o,"/card"),{title:"".concat(e.title," (Copy)"),list_id:e.list_id,position:e.position+1,description:e.description,custom:e.custom})).data.result&&(h(),v("/board/".concat(o)),n().success({title:"\u041a\u0430\u0440\u0442\u043a\u0443 \u0441\u043a\u043e\u043f\u0456\u0439\u043e\u0432\u0430\u043d\u043e",position:"topRight"}))}catch(t){console.error("Error copying card:",t)}},className:"card-details-action-button",children:"\u041a\u043e\u043f\u0456\u044e\u0432\u0430\u0442\u0438"}),(0,p.jsxs)("div",{className:"card-details-move-button-wrapper",children:[S.filter((t=>t.id!==e.list_id)).length>0&&(0,p.jsx)("button",{onClick:()=>_(!A),className:"card-details-action-button",children:"\u041f\u0435\u0440\u0435\u043c\u0456\u0449\u0435\u043d\u043d\u044f"}),A&&(0,p.jsx)("div",{className:"card-details-move-dropdown",children:S.filter((t=>t.id!==e.list_id)).map((t=>(0,p.jsx)("button",{onClick:()=>(async t=>{try{var a;"Updated"===(await d.A.put("/board/".concat(o,"/card"),[{id:e.id,list_id:t,position:(null===(a=S.find((a=>a.id===t)))||void 0===a?void 0:a.cards.length)||0}])).data.result&&(h(),b((0,l.qf)((0,i.A)((0,i.A)({},e),{},{list_id:t}))),n().success({title:"\u041a\u0430\u0440\u0442\u043a\u0443 \u043f\u0435\u0440\u0435\u043c\u0456\u0449\u0435\u043d\u043e",position:"topRight"}))}catch(s){console.error("Error moving card:",s)}_(!1)})(t.id),children:t.title},t.id)))})]}),(0,p.jsx)("button",{className:"card-details-action-button card-details-action-button--archive",onClick:async()=>{try{"Deleted"===(await d.A.delete("/board/".concat(o,"/card/").concat(e.id))).data.result&&(h(),v("/board/".concat(o)),n().success({title:"\u041a\u0430\u0440\u0442\u043a\u0443 \u0430\u0440\u0445\u0456\u0432\u043e\u0432\u0430\u043d\u043e",position:"topRight"}))}catch(t){console.error("Error archiving card:",t)}},children:"\u0410\u0440\u0445\u0456\u0432\u0443\u0432\u0430\u0442\u0438"})]})]})})}}}]);
//# sourceMappingURL=193.09a3fb07.chunk.js.map