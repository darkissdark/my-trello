"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[193],{193:(t,e,a)=>{a.r(e),a.d(e,{CardDetails:()=>p});var r=a(379),c=a(43),i=a(2),s=a(3),d=a(603),o=a(979),n=a.n(o),l=a(373),u=a(579);function p(t){var e;let{card:a,boardId:o,onCardUpdated:p,currentUserId:h}=t;const m=(0,i.Zp)(),v=(0,s.wA)(),[b,f]=(0,c.useState)(a.title),[y,g]=(0,c.useState)(a.description||""),[x,j]=(0,c.useState)([]),[w,E]=(0,c.useState)(!1),[C,N]=(0,c.useState)(!1),[k,A]=(0,c.useState)(!1),[_,S]=(0,c.useState)([]),U=(0,c.useRef)(null),R=(0,c.useRef)(null),L=(0,c.useRef)(null),D=t=>{t.style.height="auto",t.style.height="".concat(t.scrollHeight,"px")};(0,c.useEffect)((()=>{L.current&&D(L.current)}),[y]),(0,c.useEffect)((()=>{const t=t=>{if("Escape"===t.key){var e,r;if(w)f(a.title),E(!1),null===(e=R.current)||void 0===e||e.blur();if(C)g(a.description||""),N(!1),null===(r=L.current)||void 0===r||r.blur();k&&A(!1),w||C||k||(v((0,l.Oo)()),m("/board/".concat(o)))}},e=t=>{U.current&&!U.current.contains(t.target)&&(v((0,l.Oo)()),m("/board/".concat(o)))};return document.addEventListener("keydown",t),document.addEventListener("mousedown",e),()=>{document.removeEventListener("keydown",t),document.removeEventListener("mousedown",e)}}),[o,m,w,C,k,a.title,a.description,v]),(0,c.useEffect)((()=>{(async()=>{try{const t=await d.A.get("/board/".concat(o));S(t.data.lists||[])}catch(t){console.error("Error fetching lists:",t)}})(),(async()=>{if(a.users&&a.users.length>0)try{const t=await Promise.all(a.users.map((t=>d.A.get("/board/".concat(o,"/user/").concat(t)))));j(t.map((t=>t.data)))}catch(t){console.error("Error fetching card users:",t)}})()}),[o,a.users]);const O=async()=>{if(b.trim()!==a.title){if(""===b.trim())return f(a.title),void E(!1);try{"Updated"===(await d.A.put("/board/".concat(o,"/card/").concat(a.id),{title:b.trim(),description:a.description||"",list_id:a.list_id})).data.result&&(p(),E(!1))}catch(t){console.error("Error updating card title:",t),f(a.title)}}else E(!1)};return(0,u.jsx)("div",{className:"card-details-overlay",children:(0,u.jsxs)("div",{className:"card-details-modal",ref:U,children:[(0,u.jsx)("button",{className:"card-details-close",onClick:()=>{v((0,l.Oo)()),m("/board/".concat(o))},children:"\xd7"}),(0,u.jsxs)("div",{className:"card-details-content",children:[(0,u.jsx)("input",{ref:R,type:"text",value:b,onChange:t=>f(t.target.value),onBlur:O,onFocus:()=>E(!0),onKeyDown:t=>"Enter"===t.key&&O()}),(0,u.jsxs)("div",{children:["\u0412 \u043a\u043e\u043b\u043e\u043d\u0446\u0456: ",null===(e=_.find((t=>t.id===a.list_id)))||void 0===e?void 0:e.title]}),(0,u.jsxs)("div",{className:"card-details-participants",children:[(0,u.jsx)("h3",{children:"\u0423\u0447\u0430\u0441\u043d\u0438\u043a\u0438"}),(0,u.jsxs)("div",{className:"card-details-participant-list",children:[x.map((t=>(0,u.jsx)("div",{className:"card-details-participant-avatar",children:t.username.charAt(0).toUpperCase()},t.id))),(0,u.jsx)("button",{className:"card-details-join-button",onClick:async()=>{if(!x.some((t=>t.id===h)))try{if("Updated"===(await d.A.put("/board/".concat(o,"/card/").concat(a.id,"/users"),{add:[h]})).data.result){const t=await d.A.get("/board/".concat(o,"/user/").concat(h));j([...x,t.data]),p()}}catch(t){console.error("Error joining card:",t)}},children:"\u041f\u0440\u0438\u0454\u0434\u043d\u0430\u0442\u0438\u0441\u044f"})]})]}),(0,u.jsxs)("div",{className:"card-details-description",children:[(0,u.jsx)("h3",{children:"\u041e\u043f\u0438\u0441"}),(0,u.jsx)("textarea",{ref:L,value:y,onFocus:()=>N(!0),onChange:t=>{g(t.target.value),D(t.target)},onBlur:async()=>{if(y.trim()!==a.description)try{"Updated"===(await d.A.put("/board/".concat(o,"/card/").concat(a.id),{title:a.title,description:y.trim(),list_id:a.list_id})).data.result&&(p(),N(!1))}catch(t){console.error("Error updating card description:",t),g(a.description||"")}else N(!1)},placeholder:"\u0414\u043e\u0434\u0430\u0439\u0442\u0435 \u0434\u043e\u043a\u043b\u0430\u0434\u043d\u0456\u0448\u0438\u0439 \u043e\u043f\u0438\u0441..."})]})]}),(0,u.jsxs)("div",{className:"card-details-actions",children:[(0,u.jsx)("h3",{children:"\u0414\u0456\u0457"}),(0,u.jsx)("button",{onClick:async()=>{try{"Created"===(await d.A.post("/board/".concat(o,"/card"),{title:"".concat(a.title," (Copy)"),list_id:a.list_id,position:a.position+1,description:a.description,custom:a.custom})).data.result&&(p(),m("/board/".concat(o)),n().success({title:"\u041a\u0430\u0440\u0442\u043a\u0443 \u0441\u043a\u043e\u043f\u0456\u0439\u043e\u0432\u0430\u043d\u043e",position:"topRight"}))}catch(t){console.error("Error copying card:",t)}},className:"card-details-action-button",children:"\u041a\u043e\u043f\u0456\u044e\u0432\u0430\u0442\u0438"}),(0,u.jsxs)("div",{className:"card-details-move-button-wrapper",children:[(0,u.jsx)("button",{onClick:()=>A(!k),className:"card-details-action-button",children:"\u041f\u0435\u0440\u0435\u043c\u0456\u0449\u0435\u043d\u043d\u044f"}),k&&(0,u.jsx)("div",{className:"card-details-move-dropdown",children:_.map((t=>(0,u.jsx)("button",{onClick:()=>(async t=>{try{var e;"Updated"===(await d.A.put("/board/".concat(o,"/card"),[{id:a.id,list_id:t,position:(null===(e=_.find((e=>e.id===t)))||void 0===e?void 0:e.cards.length)||0}])).data.result&&(p(),v((0,l.qf)((0,r.A)((0,r.A)({},a),{},{list_id:t}))),n().success({title:"\u041a\u0430\u0440\u0442\u043a\u0443 \u043f\u0435\u0440\u0435\u043c\u0456\u0449\u0435\u043d\u043e",position:"topRight"}))}catch(c){console.error("Error moving card:",c)}A(!1)})(t.id),children:t.title},t.id)))})]}),(0,u.jsx)("button",{className:"card-details-action-button card-details-action-button--archive",onClick:async()=>{try{"Deleted"===(await d.A.delete("/board/".concat(o,"/card/").concat(a.id))).data.result&&(p(),m("/board/".concat(o)),n().success({title:"\u041a\u0430\u0440\u0442\u043a\u0443 \u0430\u0440\u0445\u0456\u0432\u043e\u0432\u0430\u043d\u043e",position:"topRight"}))}catch(t){console.error("Error archiving card:",t)}},children:"\u0410\u0440\u0445\u0456\u0432\u0443\u0432\u0430\u0442\u0438"})]})]})})}}}]);
//# sourceMappingURL=193.c0594dfe.chunk.js.map