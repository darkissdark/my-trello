"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[193],{193:(a,e,t)=>{t.r(e),t.d(e,{CardDetails:()=>h});var s=t(379),i=t(43),d=t(2),r=t(3),c=t(603),n=t(979),o=t.n(n),l=t(373),u=t(886),p=t(579);function h(a){var e;let{card:t,boardId:n,onCardUpdated:h,currentUser:m}=a;const v=(0,r.wA)(),j=(0,d.Zp)(),x=(0,i.useRef)(null),[b,y]=(0,i.useState)(t.title),[g,N]=(0,i.useState)(t.description||""),[f,w]=(0,i.useState)([]),[C,k]=(0,i.useState)([]),[A,E]=(0,i.useState)(!1),S=f.some((a=>a.id===(null===m||void 0===m?void 0:m.id))),U=(0,i.useCallback)((()=>{v((0,l.Oo)()),j("/board/".concat(n))}),[v,j,n]);(0,i.useEffect)((()=>{const a=a=>"Escape"===a.key&&U(),e=a=>{x.current&&!x.current.contains(a.target)&&U()};return document.addEventListener("keydown",a),document.addEventListener("mousedown",e),()=>{document.removeEventListener("keydown",a),document.removeEventListener("mousedown",e)}}),[U]),(0,i.useEffect)((()=>{(async()=>{try{const a=await c.A.get("/board/".concat(n));k(a.data.lists||[])}catch(a){console.error("Error fetching lists:",a)}})(),(()=>{var a;if(null!==(a=t.users)&&void 0!==a&&a.length&&m){const a=t.users.map((a=>({id:a,email:m.email||"no email",username:m.username||"no username"})));w(a)}})()}),[n,t.users,m]);const _=async a=>{try{"Updated"===(await c.A.put("/board/".concat(n,"/card/").concat(t.id),(0,s.A)((0,s.A)({},t),a))).data.result&&h()}catch(e){console.error("Error updating card:",e)}};return(0,p.jsx)("div",{className:"card-details-overlay",children:(0,p.jsxs)("div",{className:"card-details-modal",ref:x,children:[(0,p.jsx)("button",{className:"card-details-close",onClick:U,children:"\xd7"}),(0,p.jsxs)("div",{className:"mobile-scroll-wrapper",children:[(0,p.jsxs)("div",{className:"card-details-content",children:[(0,p.jsx)("div",{className:"card-details-title",children:(0,p.jsx)(u.Y,{as:"textarea",value:b,onChange:y,onBlur:()=>_({title:b}),onSubmit:()=>_({title:b}),placeholder:"\u041d\u0430\u0437\u0432\u0430 \u043a\u0430\u0440\u0442\u043a\u0438"})}),(0,p.jsxs)("div",{className:"card-details-scroll-wrapper",children:[(0,p.jsxs)("div",{children:["\u0412 \u043a\u043e\u043b\u043e\u043d\u0446\u0456:"," ",C.length?(null===(e=C.find((a=>a.id===t.list_id)))||void 0===e?void 0:e.title)||"\u041d\u0435\u0432\u0456\u0434\u043e\u043c\u043e":"\u0417\u0430\u0432\u0430\u043d\u0442\u0430\u0436\u0435\u043d\u043d\u044f..."]}),(0,p.jsxs)("div",{className:"card-details-participants",children:[(0,p.jsx)("h3",{children:"\u0423\u0447\u0430\u0441\u043d\u0438\u043a\u0438"}),(0,p.jsxs)("div",{className:"card-details-participant-list",children:[f.map((a=>(0,p.jsx)("div",{className:"card-details-participant-avatar",children:a.username[0].toUpperCase()},a.id))),(0,p.jsx)("button",{onClick:async()=>{if(!m)return;const a=S?"remove":"add";try{"Updated"===(await c.A.put("/board/".concat(n,"/card/").concat(t.id,"/users"),{add:"add"===a?[m.id]:[],remove:"remove"===a?[m.id]:[]})).data.result&&(w((e=>"add"===a?[...e,m]:e.filter((a=>a.id!==m.id)))),h())}catch(e){console.error("Error ".concat("add"===a?"joining":"leaving"," card:"),e)}},className:"card-details-join-button",children:S?"\u041f\u043e\u043a\u0438\u043d\u0443\u0442\u0438":"\u041f\u0440\u0438\u0454\u0434\u043d\u0430\u0442\u0438\u0441\u044f"})]})]}),(0,p.jsxs)("div",{className:"card-details-description",children:[(0,p.jsx)("h3",{children:"\u041e\u043f\u0438\u0441"}),(0,p.jsx)(u.Y,{value:g,onChange:N,onBlur:()=>_({description:g}),placeholder:"\u0414\u043e\u0434\u0430\u0439\u0442\u0435 \u043e\u043f\u0438\u0441...",as:"textarea",disableValidation:!0})]})]})]}),(0,p.jsxs)("div",{className:"card-details-actions",children:[(0,p.jsx)("h3",{children:"\u0414\u0456\u0457"}),(0,p.jsx)("button",{onClick:async()=>{try{"Created"===(await c.A.post("/board/".concat(n,"/card"),(0,s.A)((0,s.A)({},t),{},{title:"".concat(t.title," - Copy"),position:t.position+1}))).data.result&&(h(),o().success({title:"\u041a\u0430\u0440\u0442\u043a\u0443 \u0441\u043a\u043e\u043f\u0456\u0439\u043e\u0432\u0430\u043d\u043e",position:"topRight"}),U())}catch(a){console.error("Error copying card:",a)}},className:"card-details-action-button",children:"\u041a\u043e\u043f\u0456\u044e\u0432\u0430\u0442\u0438"}),C.length>1&&(0,p.jsxs)("div",{className:"card-details-move-button-wrapper",children:[(0,p.jsx)("button",{onClick:()=>E(!A),className:"card-details-action-button",children:"\u041f\u0435\u0440\u0435\u043c\u0456\u0449\u0435\u043d\u043d\u044f"}),A&&(0,p.jsx)("div",{className:"card-details-move-dropdown",children:C.filter((a=>a.id!==t.list_id)).map((a=>(0,p.jsx)("button",{onClick:()=>(async a=>{try{var e;"Updated"===(await c.A.put("/board/".concat(n,"/card"),[{id:t.id,list_id:a,position:(null===(e=C.find((e=>e.id===a)))||void 0===e?void 0:e.cards.length)||0}])).data.result&&(h(),v((0,l.qf)((0,s.A)((0,s.A)({},t),{},{list_id:a}))),o().success({title:"\u041a\u0430\u0440\u0442\u043a\u0443 \u043f\u0435\u0440\u0435\u043c\u0456\u0449\u0435\u043d\u043e",position:"topRight"}))}catch(i){console.error("Error moving card:",i)}E(!1)})(a.id),children:a.title},a.id)))})]}),(0,p.jsx)("button",{onClick:async()=>{try{"Deleted"===(await c.A.delete("/board/".concat(n,"/card/").concat(t.id))).data.result&&(h(),o().success({title:"\u041a\u0430\u0440\u0442\u043a\u0443 \u0430\u0440\u0445\u0456\u0432\u043e\u0432\u0430\u043d\u043e",position:"topRight"}),U())}catch(a){console.error("Error archiving card:",a)}},className:"card-details-action-button card-details-action-button--archive",children:"\u0410\u0440\u0445\u0456\u0432\u0443\u0432\u0430\u0442\u0438"})]})]})]})})}}}]);
//# sourceMappingURL=193.f9746af1.chunk.js.map